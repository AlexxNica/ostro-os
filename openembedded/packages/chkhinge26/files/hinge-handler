#!/bin/sh
#
# Quick handler for chkhinge26 and X. 
#

killproc() {            # kill the named process(es)
        pid=`/bin/ps -e x |
             /bin/grep $1 |
             /bin/grep -v grep |
             /bin/sed -e 's/^  *//' -e 's/ .*//'`
        [ "$pid" != "" ] && kill $pid
}

export DISPLAY=:0

if [ -z "$1" ]; then
   echo "Usage: hinge-handler <state> ( 3 = closed, 0 = landscape, 2 = portrait )"
   exit 1
fi

STATE=$1

if [ $STATE = "3" ]; then
   echo "sleeping"
   apm -s
   exit 0
fi

if [ $STATE = "0" ]; then
   echo "lanscape"
   killproc /usr/bin/mbinputmgr
# urg mbinputmgr should kill below
   killproc /usr/bin/matchbox-keyboard
   killproc /usr/bin/matchbox-stroke
   xrandr -o normal
   exit 0
fi

if [ $STATE = "2" ]; then
   echo "portrait"
   xrandr -o left 
# just to be extra safe
   sleep 1 
   /usr/bin/mbinputmgr &
   exit 0
fi

