<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
"http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">

<chapter>
<title>File download support</title>

    <section>
        <title>Overview</title>

        <para>
            BitBake provides support to download files
            this procedure is called fetching and it handled by the
            fetch and fetch2 modules.
            At this point the original fetch code is considered to
            be replaced by fetch2 and this manual only related
            to the fetch2 codebase.
        </para>

        <para>
            The <filename>SRC_URI</filename> is normally used to
            tell BitBake which files to fetch.
            The next sections will describe the available fetchers and
            their options.
            Each fetcher honors a set of variables and per
            URI parameters separated by a <quote>;</quote> consisting of a key and
            a value.
            The semantics of the variables and parameters are
            defined by the fetcher.
            BitBake tries to have consistent semantics between the
            different fetchers.
        </para>

        <para>
            The overall fetch process is that first, fetches are attempted from
            <filename>PREMIRRORS</filename>.
            If those don't work, the original <filename>SRC_URI</filename>
            is attempted
            and if that fails, BitBake will fall back to
            <filename>MIRRORS</filename>.
            Cross urls are supported, so its possible to mirror
            a git repository on an http server as a tarball for example.
            Some example commonly used mirror
            definitions are:
            <literallayout class='monospaced'>
PREMIRRORS ?= "\
    bzr://.*/.*   http://somemirror.org/sources/ \n \
    cvs://.*/.*   http://somemirror.org/sources/ \n \
    git://.*/.*   http://somemirror.org/sources/ \n \
    hg://.*/.*    http://somemirror.org/sources/ \n \
    osc://.*/.*   http://somemirror.org/sources/ \n \
    p4://.*/.*    http://somemirror.org/sources/ \n \
    svk://.*/.*   http://somemirror.org/sources/ \n \
    svn://.*/.*   http://somemirror.org/sources/ \n"

MIRRORS =+ "\
    ftp://.*/.*      http://somemirror.org/sources/ \n \
    http://.*/.*     http://somemirror.org/sources/ \n \
    https://.*/.*    http://somemirror.org/sources/ \n"
            </literallayout>
        </para>

        <para>
            Non-local downloaded output is placed
            into the directory specified by the
            <filename>DL_DIR</filename> variable.
            For non local archive downloads the code can verify
            sha256 and md5 checksums for the download to ensure
            the file has been downloaded correctly.
            These may be specified either in the form
            <filename>SRC_URI[md5sum]</filename>
            for the md5 checksum and
            <filename>SRC_URI[sha256sum]</filename>
            for the sha256 checksum or as parameters on the SRC_URI such as
            SRC_URI="http://example.com/foobar.tar.bz2;md5sum=4a8e0f237e961fd7785d19d07fdb994d".
            If <filename>BB_STRICT_CHECKSUM</filename> is set, any download
            without a checksum will trigger an error message.
            In cases where multiple files are listed in
            SRC_URI, the name parameter is used
            assign names to the urls and these are then specified
            in the checksums in the form
     SRC_URI[name.sha256sum].
        </para>
    </section>

    <section>
        <title>Local file fetcher</title>

        <para>
            The URN for the local file fetcher is file.
            The filename can be either absolute or relative.
            If the filename is relative,
            <filename>FILESPATH</filename> and failing that
            <filename>FILESDIR</filename> will be used to find the
            appropriate relative file.
            The metadata usually extend these variables to include
            variations of the values in <filename>OVERRIDES</filename>.
            Single files and complete directories can be specified.
            <literallayout class='monospaced'>
     SRC_URI = "file://relativefile.patch"
     SRC_URI = "file://relativefile.patch;this=ignored"
     SRC_URI = "file:///Users/ich/very_important_software"
            </literallayout>
        </para>
    </section>

    <section>
        <title>CVS fetcher</title>

        <para>
            The URN for the CVS fetcher is cvs.
            This fetcher honors the variables <filename>CVSDIR</filename>,
            <filename>SRCDATE</filename>, <filename>FETCHCOMMAND_cvs</filename>,
            <filename>UPDATECOMMAND_cvs</filename>.
            <filename>DL_DIR</filename> specifies where a
            temporary checkout is saved.
            <filename>SRCDATE</filename> specifies which date to
            use when doing the fetching (the special value of "now"
            will cause the checkout to be updated on every build).
            <filename>FETCHCOMMAND</filename> and
            <filename>UPDATECOMMAND</filename> specify which executables
            to use for the CVS checkout or update.
        </para>

        <para>
            The supported parameters are module, tag, date,
            method, localdir, rshand scmdata.
            The module specifies which module to check out,
            the tag describes which CVS TAG should be used for
            the checkout.
            By default, the TAG is empty.
            A date can be specified to override the
            <filename>SRCDATE</filename> of the
            configuration to checkout a specific date.
            The special value of "now" will cause the checkout to be
            updated on every build.
            method is by default pserver.
            If ext is used the rsh parameter will be evaluated
            and <filename>CVS_RSH</filename> will be set.
            Finally, localdir is used to checkout into a special
            directory relative to <filename>CVSDIR</filename>.
            <literallayout class='monospaced'>
     SRC_URI = "cvs://CVSROOT;module=mymodule;tag=some-version;method=ext"
     SRC_URI = "cvs://CVSROOT;module=mymodule;date=20060126;localdir=usethat"
            </literallayout>
        </para>
    </section>

    <section>
        <title>HTTP/FTP fetcher</title>

        <para>
            The URNs for the HTTP/FTP fetcher are http, https and ftp.
            This fetcher honors the variables
            <filename>FETCHCOMMAND_wget</filename>.
            <filename>FETCHCOMMAND</filename> contains the command used
            for fetching.
            <quote>${URI}</quote> and <quote>${FILES}</quote> will be replaced by the URI and
            basename of the file to be fetched.
            <literallayout class='monospaced'>
     SRC_URI = "http://oe.handhelds.org/not_there.aac"
     SRC_URI = "ftp://oe.handhelds.org/not_there_as_well.aac"
     SRC_URI = "ftp://you@oe.handheld.sorg/home/you/secret.plan"
            </literallayout>
        </para>
    </section>

    <section>
        <title>SVN fetcher</title>
        <para>
            The URN for the SVN fetcher is svn.
        </para>

        <para>
            This fetcher honors the variables
            <filename>FETCHCOMMAND_svn</filename>,
            <filename>SVNDIR</filename>,
            <filename>SRCREV</filename>.
            <filename>FETCHCOMMAND</filename> contains the
            subversion command.
            <filename>SRCREV</filename> specifies which revision
            to use when doing the fetching.
        </para>

        <para>
            The supported parameters are proto, rev and scmdata.
            proto is the Subversion protocol, rev is the
            Subversion revision.
            If scmdata is set to <quote>keep</quote>, the <quote>.svn</quote> directories will
             be available during compile-time.
            <literallayout class='monospaced'>
     SRC_URI = "svn://svn.oe.handhelds.org/svn;module=vip;proto=http;rev=667"
     SRC_URI = "svn://svn.oe.handhelds.org/svn/;module=opie;proto=svn+ssh;date=20060126"
            </literallayout>
        </para>
    </section>

    <section>
        <title>GIT fetcher</title>
        <para>
            The URN for the GIT Fetcher is git.
        </para>

        <para>
            The variable <filename>GITDIR</filename> will be used as the
            base directory where the git tree is cloned to.
        </para>

        <para>
            The parameters are tag, protocol and scmdata.
             tag is a Git tag, the default is <quote>master</quote>.
             protocol is the Git protocol to use and defaults to <quote>git</quote>
            if a hostname is set, otherwise its <quote>file</quote>.
            If scmdata is set to <quote>keep</quote>, the <quote>.git</quote> directory will be available
            during compile-time.
            <literallayout class='monospaced'>
     SRC_URI = "git://git.oe.handhelds.org/git/vip.git;tag=version-1"
     SRC_URI = "git://git.oe.handhelds.org/git/vip.git;protocol=http"
            </literallayout>
        </para>
    </section>
</chapter>
