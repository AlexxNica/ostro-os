#!/usr/bin/python
import oeparser
import sys
from oe import *

def usage(var):
	print "usage: parse <somebuildfile.oe>"
	sys.exit(1)

if len(sys.argv) < 2:
	usage(1)

__oepath_found_it__ = 0

for s in getenv('OEPATH').split(":"):
	if os.access(os.path.join(s,'conf/oe.conf'), os.R_OK):
		__oepath_found_it__ = 1
		try:
			b = oeparser.ConfigReader(os.path.join(s,"conf/oe.conf"))
			b.reader()
		except IOError:
			pass

if __oepath_found_it__ == 0:
	fatal("error locating conf/oe.conf")

try:
	c = oeparser.PackageReader(sys.argv[1])
	c.cfgenv = b.env # point the package reader to our config data
	c.reader()
	
	for i in b.env.keys():
		if not c.env.has_key(i):
			c.env[i] = b.env[i]
except IOError:
	fatal("error accessing build file")

emit_env(sys.__stdout__, c.env)
sys.exit(0)
