#@TYPE: Distribution#@NAME: Poky
#@DESCRIPTION: Distribution configuration for OpenedHand (Poky)

DISTRO = "poky"
DISTRO_NAME = "OpenedHand Linux (Poky)"
DISTRO_VERSION = "0.0-snapshot-${DATE}"

MAINTAINER = "OpenedHand <poky@openedhand.com>"

PACKAGE_CLASSES ?= "package_ipk"
INHERIT += " ${PACKAGE_CLASSES} debian multimachine poky devshell "
#INHERIT += " package_deb debian multimachine poky devshell "
# For some reason, this doesn't work
# TARGET_OS ?= "linux"
# TARGET_VENDOR ?= "-poky"
# Set by POKYMODE instead
TARGET_OS = "linux"
TARGET_FPU_arm ?= "soft"
TARGET_FPU_armeb ?= "soft"
IMAGE_ROOTFS_SIZE_ext2 ?= "131072"

#FEED_URIS += " \
#           upgrades##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/upgrades/ \
#upgrades-${MACHINE}##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/upgrades/${MACHINE} \
#            machine##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/machine/${MACHINE} \
#               base##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/base/ \
#               libs##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/libs/ \
#            console##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/console \
#              devel##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/devel"

ASSUME_PROVIDED += "virtual/arm-linux-gcc-2.95"
OEINCLUDELOGS = "yes"
KERNEL_CONSOLE = "ttyS0"
#DEBUG_OPTIMIZATION = "-O -g3"
#DEBUG_BUILD = "1"
#INHIBIT_PACKAGE_STRIP = "1"

# Default to TARGETOS values for EABI
GLIBCTARGETOS = "linux${@['','-gnueabi'][bb.data.getVar('TARGET_ARCH',d,1) in ['arm', 'armeb']]}"
UCLIBCTARGETOS = "linux${@['-uclibc','-uclibcgnueabi'][bb.data.getVar('TARGET_ARCH',d,1) in ['arm', 'armeb']]}"

POKYMODE ?= "eabi"
require conf/distro/include/poky-${POKYMODE}.inc

POKYLIBC ?= "glibc"
require conf/distro/include/poky-${POKYLIBC}.inc

#
# Preferred providers:
#

# Virtuals:
PREFERRED_PROVIDER_virtual/db ?= "db"
PREFERRED_PROVIDER_virtual/db-native ?= "db-native"
PREFERRED_PROVIDER_virtual/xserver ?= "xserver-kdrive"
PREFERRED_PROVIDER_virtual/update-alternatives ?= "update-alternatives-cworth"
PREFERRED_PROVIDER_virtual/update-alternatives-native ?= "update-alternatives-cworth-native"
PREFERRED_PROVIDER_virtual/libx11 ?= "diet-x11"

VIRTUAL-RUNTIME_update-alternatives ?= "update-alternatives-cworth"

# Others:
PREFERRED_PROVIDER_linux-libc-headers ?= "linux-libc-headers"
PREFERRED_PROVIDER_dbus-glib ?= "dbus-glib"
PREFERRED_PROVIDER_dbus-glib-native ?= "dbus-glib-native"
PREFERRED_PROVIDER_gconf ?= "gconf-dbus"
PREFERRED_PROVIDER_matchbox-panel ?= "matchbox-panel-2"


#
# Source dates or revisions to use:
#
SRCREV_pn-gconf-dbus ?= "604"
SRCREV_pn-contacts ?= "327"
SRCREV_pn-dates ?= "470"
SRCREV_pn-gtkhtml2 ?= "1144"
SRCREV_pn-web ?= "96"
SRCREV_pn-eds-dbus ?= "625"
SRCDATE_minimo ?= "20070510"
SRCDATE_ipkg-utils-native ?= "20050930"
SRCDATE_ipkg-link-1 ?= "20050930"
SRCDATE_ipkg-utils ?= "20050930"
SRCDATE_ipkg-link ?= "20050930"
SRCREV_pn-matchbox-common ?= "1561"
SRCREV_pn-matchbox-config-gtk ?= "1614"
SRCREV_pn-matchbox-desktop ?= "1708"
SRCREV_pn-matchbox-keyboard ?= "1584"
SRCREV_pn-matchbox-panel ?= "1364"
SRCDATE_matchbox-panel-manager ?= "20060612"
SRCREV_pn-matchbox-panel-2 ?= "1605"
SRCREV_pn-matchbox-stroke ?= "1524"
SRCREV_pn-matchbox-themes-extra ?= "1524"
SRCREV_pn-matchbox-terminal ?= "1612"
SRCREV_pn-matchbox-wm ?= "1524"
SRCDATE_libmatchbox ?= "20070417"
SRCREV_pn-settings-daemon ?= "1615"
SRCREV_pn-screenshot ?= "288"
SRCDATE_xcalibrateext ?= "20051101"
SRCREV_pn-libfakekey ?= "1270"
SRCDATE_xcalibrate ?= "20060312"
SRCDATE_oprofile ?= "20070928"
SRCREV_pn-oprofileui ?= "160"
SRCREV_pn-zaurusd ?= "296"
SRCREV_pn-owl-video-widget ?= "266"
SRCREV_pn-psplash ?= "266"
SRCDATE_maemo-mapper-nohildon ?= "20061114"
SRCREV_pn-exmap-console ?= "266"
SRCREV_pn-gtk-sato-engine ?= "90"
SRCREV_pn-matchbox-theme-sato ?= "90"
SRCREV_pn-tasks ?= "343"
SRCREV_pn-sato-icon-theme ?= "90"
SRCREV_pn-matchbox-desktop-sato ?= "76"
SRCREV_pn-evince ?= "2437"
SRCREV_pn-oh-puzzles ?= "22"
SRCREV_pn-libowl ?= "277"
SRCDATE_libxcalibrate ?= "20070607"
SRCDATE_calibrateproto ?= "20070607"
SRCREV_ohm ?= "f4908f9a2508e79a1e58fb6c08f602f4cbccb97d"
SRCDATE_gtk-theme-torturer ?= "20070529"
SRCREV_pn-libsyncml ?= "241"
SRCREV_pn-matchbox-applet-light ?= "1548"
SRCREV_pn-fstests ?= "266"
SRCDATE_abiword ?= "20070130"
SRCREV_pn-xvideo-tests ?= "272"
SRCREV_pn-clutter ?= "1495"
SRCDATE_libgsmd ?= "20070917"
SRCREV_gaku ?= "286"
SRCREV_gypsy ?= "39"

# Previously floating revisions
SRCREV_pn-aaina ?= "1231"
SRCREV_pn-clutter-cairo ?= "1223"
SRCREV_pn-clutter-gst ?= "1454"
SRCREV_pn-table ?= "1456"
SRCREV_pn-libmatchbox ?= "1531"
SRCREV_pn-msynctool ?= "314"
SRCREV_pn-libopensync-plugin-file-sync ?= "2392"
SRCREV_pn-libopensync-plugin-evo2-sync ?= "2394"
SRCREV_pn-libopensync ?= "2430"
SRCREV_pn-libsync ?= "208"
SRCREV_pn-tasks ?= "299"
SRCREV_pn-networkmanager-applet ?= "200"
SRCREV_pn-networkmanager ?= "2887"

#
# Preferred Versions:
#
PREFERRED_VERSION_dates ?= "0.4.4+svnr${SRCREV}"
PREFERRED_VERSION_matchbox ?= "0.9.1"
PREFERRED_VERSION_matchbox-applet-inputmanager ?= "0.6"
PREFERRED_VERSION_matchbox-applet-startup-monitor ?= "0.1"
PREFERRED_VERSION_matchbox-common ?= "0.9.1+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-config-gtk ?= "0.0+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-desktop ?= "2.0+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-keyboard ?= "0.0+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-panel ?= "0.9.2+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-stroke ?= "0.0+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-themes-extra ?= "0.3+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-wm ?= "1.2+svnr${SRCREV}"
PREFERRED_VERSION_libmatchbox ?= "1.9"
PREFERRED_VERSION_gtk-engines ?= "2.10.2"
PREFERRED_VERSION_gtk-sato-engine ?= "0.1"
PREFERRED_VERSION_matchbox-theme-sato ?= "0.1"
PREFERRED_VERSION_sato-icon-theme ?= "0.1"

PREFERRED_VERSION_glib-2.0 ?= "2.14.1"
PREFERRED_VERSION_glib-2.0-native ?= "2.12.4"
PREFERRED_VERSION_atk ?= "1.18.0"
PREFERRED_VERSION_cairo ?= "1.4.10"
PREFERRED_VERSION_pango ?= "1.18.1"
PREFERRED_VERSION_gtk+ ?= "2.10.14"

PREFERRED_VERSION_dbus ?= "1.0.2"
PREFERRED_VERSION_dbus-native ?= "1.0.2"
PREFERRED_VERSION_dbus-glib ?= "0.74"
PREFERRED_VERSION_dbus-glib-native ?= "0.74"
PREFERRED_VERSION_gnome-vfs ?= "2.18.1"
PREFERRED_VERSION_libgnomecanvas ?= "2.14.0"

PREFERRED_VERSION_dillo2 ?= "0.6.6"
PREFERRED_VERSION_evince ?= "0.9.0"
PREFERRED_VERSION_firefox ?= "1.0"
PREFERRED_VERSION_gaim ?= "2.0.0-cvs-mco1-20050904"
PREFERRED_VERSION_gtk2-theme-angelistic ?= "0.3"
PREFERRED_VERSION_keylaunch ?= "2.0.7"
PREFERRED_VERSION_librsvg ?= "2.18.2"
PREFERRED_VERSION_libgsm ?= "1.0.10"
PREFERRED_VERSION_libschedule ?= "0.15"
PREFERRED_VERSION_linphone-hh ?= "0.12.2.hh1"
PREFERRED_VERSION_linphone ?= "0.12.2"
PREFERRED_VERSION_minilite ?= "0.49"
PREFERRED_VERSION_minimo ?= "0.02+cvs${SRCDATE_minimo}"
PREFERRED_VERSION_poppler ?= "0.5.4"
PREFERRED_VERSION_rosetta ?= "0.0+cvs${SRCDATE}"
PREFERRED_VERSION_rxvt-unicode ?= "5.6"
PREFERRED_VERSION_xcursor-transparent-theme ?= "0.1.1"
PREFERRED_VERSION_xdemineur ?= "2.1.1"
PREFERRED_VERSION_xextensions ?= "1.0.1"


PREFERRED_VERSION_xmonobut ?= "0.4"
PREFERRED_VERSION_xprop ?= "0.0+cvs${SRCDATE}" 
PREFERRED_VERSION_xst ?= "0.15"
PREFERRED_VERSION_oprofile ?= "0.9.3"
PREFERRED_VERSION_elfutils ?= "0.89"
PREFERRED_VERSION_hal ?= "0.5.9.1"
PREFERRED_VERSION_hal-info ?= "20070831"

require conf/distro/include/preferred-xorg-versions.inc

PCMCIA_MANAGER ?= "pcmciautils"

CVS_TARBALL_STASH += "http://www.o-hand.com/~richard/poky/sources/"

IMAGE_LINGUAS ?= "en-gb"
LIMIT_BUILT_LOCALES ?= "en_GB"
ENABLE_BINARY_LOCALE_GENERATION ?= "1"

DISTRO_FEATURES = "alsa bluetooth ext2 irda pcmcia usbgadget usbhost wifi"
DISTRO_FEATURES_cmx270 = "alsa bluetooth ext2 irda pcmcia usbgadget usbhost"

POKY_EXTRA_RDEPENDS = ""
POKY_EXTRA_RDEPENDS_qemuarm = "qemu-config"
POKY_EXTRA_RDEPENDS_qemux86 = "qemu-config"

DISTRO_EXTRA_RDEPENDS += "${POKY_EXTRA_RDEPENDS}"

IMAGE_FEATURES ?= ""

DISTRO_TASKS = "\
    task-poky-boot \
    task-base-extended \
    "

#
# Exclude known broken packages
#
# Needs scons/python-native
EXCLUDE_FROM_WORLD_pn-libsync = "1"
EXCLUDE_FROM_WORLD_pn-libopensync = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-syncml = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-evo2-sync = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-irmc-sync = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-file-sync = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-syncml-plugin = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-syncml-client-plugin = "1"
EXCLUDE_FROM_WORLD_pn-msynctool = "1"
# Needs python
EXCLUDE_FROM_WORLD_pn-ipkg-utils = "1"
# Needs gcc 3.x
EXCLUDE_FROM_WORLD_pn-qemu = "1"
# compile failure
EXCLUDE_FROM_WORLD_pn-syncml-client = "1"
# temporary
EXCLUDE_FROM_WORLD_pn-lirc = "1"
EXCLUDE_FROM_WORLD_pn-lirc-modules = "1"
# clutter needs some kind of gl to build, not yet added
EXCLUDE_FROM_WORLD_pn-clutter = "1"
EXCLUDE_FROM_WORLD_pn-clutter-cairo = "1"
EXCLUDE_FROM_WORLD_pn-clutter-gst = "1"
EXCLUDE_FROM_WORLD_pn-aaina = "1"
EXCLUDE_FROM_WORLD_pn-table = "1"
EXCLUDE_FROM_WORLD_pn-task-poky-clutter = "1"
# Need bzr
EXCLUDE_FROM_WORLD_pn-eds-tools = "1"
