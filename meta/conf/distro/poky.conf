#@TYPE: Distribution#@NAME: Poky
#@DESCRIPTION: Distribution configuration for OpenedHand (Poky)

DISTRO = "poky"
DISTRO_NAME = "OpenedHand Linux (Poky)"
DISTRO_VERSION = "3.2+snapshot-${DATE}"

MAINTAINER = "OpenedHand <poky@openedhand.com>"

PACKAGE_CLASSES ?= "package_ipk"
INHERIT_INSANE ?= "insane"
INHERIT += "${PACKAGE_CLASSES} debian multimachine poky devshell ${INHERIT_INSANE}"
# For some reason, this doesn't work
# TARGET_OS ?= "linux"
# TARGET_VENDOR ?= "-poky"
# Set by POKYMODE instead
TARGET_OS = "linux"
TARGET_FPU_arm ?= "soft"
TARGET_FPU_armeb ?= "soft"
TARGET_FPU_nokia800 = "hard"

QA_LOG = "1"

IMAGE_ROOTFS_SIZE_ext2 ?= "131072"

# Poky is svn based
METADATA_REVISION = "${@base_get_metadata_svn_revision(d)}"

#FEED_URIS += " \
#           upgrades##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/upgrades/ \
#upgrades-${MACHINE}##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/upgrades/${MACHINE} \
#            machine##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/machine/${MACHINE} \
#               base##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/base/ \
#               libs##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/libs/ \
#            console##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/console \
#              devel##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/devel"

ASSUME_PROVIDED += "virtual/arm-linux-gcc-2.95"
OEINCLUDELOGS = "yes"
KERNEL_CONSOLE = "ttyS0"
#DEBUG_OPTIMIZATION = "-O -g3"
#DEBUG_BUILD = "1"
#INHIBIT_PACKAGE_STRIP = "1"

# Default to TARGETOS values for EABI
GLIBCTARGETOS = "linux${@['','-gnueabi'][bb.data.getVar('TARGET_ARCH',d,1) in ['arm', 'armeb']]}"
UCLIBCTARGETOS = "linux${@['-uclibc','-uclibcgnueabi'][bb.data.getVar('TARGET_ARCH',d,1) in ['arm', 'armeb']]}"

POKYMODE ?= "eabi"
require conf/distro/include/poky-${POKYMODE}.inc

POKYLIBC ?= "glibc"
require conf/distro/include/poky-${POKYLIBC}.inc

SDK_NAME = "${DISTRO}-${POKYMODE}-${POKYLIBC}-${HOST_ARCH}-${TARGET_ARCH}"
SDK_PREFIX = "/usr/local/${DISTRO}/${POKYMODE}-${POKYLIBC}/${TARGET_ARCH}"

CACHE = "${TMPDIR}/cache/${POKYMODE}-${POKYLIBC}${@['', '/' + str(bb.data.getVar('MACHINE', d, 1))][bool(bb.data.getVar('MACHINE', d, 1))]}"

#
# Preferred providers:
#

# Virtuals:
PREFERRED_PROVIDER_virtual/db ?= "db"
PREFERRED_PROVIDER_virtual/db-native ?= "db-native"
PREFERRED_PROVIDER_virtual/xserver ?= "xserver-kdrive"
PREFERRED_PROVIDER_virtual/update-alternatives ?= "update-alternatives-cworth"
PREFERRED_PROVIDER_virtual/update-alternatives-native ?= "opkg-native"
PREFERRED_PROVIDER_virtual/libx11 ?= "diet-x11"

VIRTUAL-RUNTIME_update-alternatives ?= "update-alternatives-cworth"

# Others:
PREFERRED_PROVIDER_linux-libc-headers ?= "linux-libc-headers"
PREFERRED_PROVIDER_dbus-glib ?= "dbus-glib"
PREFERRED_PROVIDER_dbus-glib-native ?= "dbus-glib-native"
PREFERRED_PROVIDER_gconf ?= "gconf-dbus"
PREFERRED_PROVIDER_matchbox-panel ?= "matchbox-panel-2"


#
# Source dates or revisions to use:
#
SRCREV_pn-gconf-dbus ?= "638"
SRCREV_pn-gtkhtml2 ?= "1144"
SRCREV_pn-web ?= "97"
SRCREV_pn-web-webkit ?= "107"
SRCREV_pn-eds-dbus ?= "629"
SRCDATE_minimo ?= "20070510"
SRCDATE_ipkg-utils-native ?= "20050930"
SRCDATE_ipkg-link-1 ?= "20050930"
SRCDATE_ipkg-utils ?= "20050930"
SRCDATE_ipkg-link ?= "20050930"
SRCREV_pn-matchbox-common ?= "1561"
SRCREV_pn-matchbox-config-gtk ?= "1614"
SRCREV_pn-matchbox-desktop ?= "2030"
SRCREV_pn-matchbox-keyboard ?= "1910"
SRCREV_pn-matchbox-panel ?= "1364"
SRCDATE_matchbox-panel-manager ?= "20060612"
SRCREV_pn-matchbox-panel-2 ?= "1971"
SRCREV_pn-matchbox-stroke ?= "1524"
SRCREV_pn-matchbox-themes-extra ?= "1524"
SRCREV_pn-matchbox-terminal ?= "1612"
SRCREV_pn-matchbox-wm ?= "1524"
SRCREV_pn-matchbox-wm-2 ?= "1873"
SRCDATE_libmatchbox ?= "20070417"
SRCREV_pn-settings-daemon ?= "1825"
SRCREV_pn-screenshot ?= "288"
SRCDATE_xcalibrateext ?= "20051101"
SRCREV_pn-libfakekey ?= "2031"
SRCDATE_xcalibrate ?= "20060312"
SRCDATE_oprofile ?= "20080210"
SRCREV_pn-oprofileui ?= "173"
SRCREV_pn-zaurusd ?= "358"
SRCREV_pn-owl-video-widget ?= "324"
SRCREV_pn-psplash ?= "363"
SRCDATE_maemo-mapper-nohildon ?= "20061114"
SRCREV_pn-exmap-console ?= "266"
SRCREV_pn-gtk-sato-engine ?= "90"
SRCREV_pn-matchbox-theme-sato ?= "90"
SRCREV_pn-matchbox-theme-sato-2 ?= "94"
SRCREV_pn-matchbox-desktop-sato ?= "76"
SRCREV_pn-evince ?= "2437"
SRCREV_pn-oh-puzzles ?= "23"
SRCREV_pn-libowl ?= "354"
SRCREV_pn-libxcalibrate ?= "7b8e29186097170e930de634a4a68072558aa056"
PV_pn-libxcalibrate ?= "0.0-poky1-${SRCREV}"
SRCREV_pn-calibrateproto ?= "1da6fd1e2c7a49648245c98481fabea8b9690a8c"
PV_pn-calibrateproto ?= "0.0-poky1-${SRCREV}"
SRCDATE_gtk-theme-torturer ?= "20060821"
SRCREV_pn-gtk-theme-torturer ?= "99962ae39bb5aadb31929b25c58e1a053f9c9545"
SRCREV_pn-libsyncml ?= "241"
SRCREV_pn-matchbox-applet-light ?= "1548"
SRCREV_pn-fstests ?= "266"
SRCDATE_abiword ?= "20070130"
SRCREV_pn-xvideo-tests ?= "272"
SRCREV_pn-clutter ?= "1495"
SRCREV_pn-clutter-gst ?= "1495"
SRCDATE_libgsmd ?= "20070917"
SRCREV_pn-gaku ?= "375"
SRCREV_pn-gypsy ?= "39"
SRCDATE_yaffs2-utils = "20071107"
SRCDATE_yaffs2-utils-native = "20071107"
SRCREV_pn-webkit-gtk ?= "31859"
SRCREV_pn-clipboard-manager ?= "14994"
SRCREV_pn-opkg ?= "4209"
SRCREV_pn-opkg-native ?= "4209"
SRCREV_pn-opkg-sdk ?= "4209"
SRCREV_pn-libxosd ?= "627"
SRCDATE_pn-qemu-native ?= "20080307"
SRCDATE_pn-qemu-sdk ?= "20080307"
SRCDATE_pn-qemu ?= "20080307"

# Previously floating revisions
SRCREV_pn-aaina ?= "1231"
SRCREV_pn-clutter-cairo ?= "1223"
SRCREV_pn-clutter-gst ?= "1454"
SRCREV_pn-table ?= "1456"
SRCREV_pn-libmatchbox ?= "1531"
SRCREV_pn-msynctool ?= "314"
SRCREV_pn-libopensync-plugin-file-sync ?= "2392"
SRCREV_pn-libopensync-plugin-evo2-sync ?= "2394"
SRCREV_pn-libopensync ?= "2430"
SRCREV_pn-libsync ?= "208"
SRCREV_pn-networkmanager ?= "2984"
SRCREV_pn-networkmanager-applet ?= "263"
SRCREV_pn-ubootchart ?= "10"

SRCREV_pn-uboot-openmoko_upstream ?= "1ce55151c85d068f70317a8d65c61058b891afb4"
SRCREV_pn-uboot-openmoko_patches ?= "3400"
SRCREV_pn-libgsmd ?= "3394"
SRCREV_pn-linux-openmoko ?= "3238"
SRCREV_pn-usbpath-native = "3172"
SRCREV_pn-usbpath = "3172"
SRCREV_pn-openmoko-dialer2 = "3407"
SRCREV_pn-openmoko-today2 = "3342"
SRCREV_pn-libmokogsmd2 = "3378"
SRCREV_pn-libmokojournal2 = "3217"
SRCREV_pn-libmokoui2 = "3229"
SRCREV_pn-openmoko-contacts2 = "363"
SRCREV_pn-openmoko-today2-folders = "3379"
SRCREV_pn-neod = "3409"
SRCREV_pn-openmoko-tasks2 = "346"
SRCREV_pn-openmoko-icon-theme-standard2 = "3247"
SRCREV_pn-openmoko-dates2 = "659"
SRCREV_pn-libjana = "693"
SRCREV_pn-dfu-util = "3139"
SRCREV_pn-dfu-util-native = "3139"
SRCREV_pn-ohm = "edfe25d49d67884bf004de7ae0724c162bb5e65e"

#
# Preferred Versions:
#
PREFERRED_VERSION_matchbox ?= "0.9.1"
PREFERRED_VERSION_matchbox-applet-inputmanager ?= "0.6"
PREFERRED_VERSION_matchbox-applet-startup-monitor ?= "0.1"
PREFERRED_VERSION_matchbox-common ?= "0.9.1+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-config-gtk ?= "0.0+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-desktop ?= "2.0+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-keyboard ?= "0.0+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-panel ?= "0.9.2+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-stroke ?= "0.0+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-themes-extra ?= "0.3+svnr${SRCREV}"
PREFERRED_VERSION_matchbox-wm ?= "1.2+svnr${SRCREV}"
PREFERRED_VERSION_libmatchbox ?= "1.9"
PREFERRED_VERSION_gtk-engines ?= "2.12.0"
PREFERRED_VERSION_gtk-sato-engine ?= "0.3.1"
PREFERRED_VERSION_matchbox-theme-sato ?= "0.1"
PREFERRED_VERSION_sato-icon-theme ?= "0.4.1"

PREFERRED_VERSION_glib-2.0 ?= "2.16.3"
PREFERRED_VERSION_glib-2.0-native ?= "2.16.3"
PREFERRED_VERSION_atk ?= "1.20.0"
PREFERRED_VERSION_cairo ?= "1.4.14"
PREFERRED_VERSION_pango ?= "1.18.3"
PREFERRED_VERSION_gtk+ ?= "2.12.7"

PREFERRED_VERSION_dbus ?= "1.1.20"
PREFERRED_VERSION_dbus-native ?= "1.1.20"
PREFERRED_VERSION_dbus-glib ?= "0.74"
PREFERRED_VERSION_dbus-glib-native ?= "0.74"
PREFERRED_VERSION_gnome-vfs ?= "2.22.0"
PREFERRED_VERSION_libgnomecanvas ?= "2.20.0"
PREFERRED_VERSION_gnome-keyring ?= "2.20"

PREFERRED_VERSION_dillo2 ?= "0.6.6"
PREFERRED_VERSION_evince ?= "2.20.0"
PREFERRED_VERSION_firefox ?= "1.0"
PREFERRED_VERSION_gaim ?= "2.0.0-cvs-mco1-20050904"
PREFERRED_VERSION_gtk2-theme-angelistic ?= "0.3"
PREFERRED_VERSION_keylaunch ?= "2.0.7"
PREFERRED_VERSION_librsvg ?= "2.18.2"
PREFERRED_VERSION_libgsm ?= "1.0.10"
PREFERRED_VERSION_libschedule ?= "0.15"
PREFERRED_VERSION_linphone-hh ?= "0.12.2.hh1"
PREFERRED_VERSION_linphone ?= "0.12.2"
PREFERRED_VERSION_minilite ?= "0.49"
PREFERRED_VERSION_minimo ?= "0.02+cvs${SRCDATE_minimo}"
PREFERRED_VERSION_poppler ?= "0.6"
PREFERRED_VERSION_rosetta ?= "0.0+cvs${SRCDATE}"
PREFERRED_VERSION_rxvt-unicode ?= "5.6"
PREFERRED_VERSION_xcursor-transparent-theme ?= "0.1.1"
PREFERRED_VERSION_xdemineur ?= "2.1.1"
PREFERRED_VERSION_xextensions ?= "1.0.1"


PREFERRED_VERSION_xmonobut ?= "0.4"
PREFERRED_VERSION_xprop ?= "1.0.3"
PREFERRED_VERSION_xst ?= "0.15"
PREFERRED_VERSION_oprofile ?= "0.9.3+cvs20080210"
PREFERRED_VERSION_elfutils ?= "0.89"
PREFERRED_VERSION_hal ?= "0.5.9.1"
PREFERRED_VERSION_hal-info ?= "20070831"

require conf/distro/include/preferred-xorg-versions.inc

PCMCIA_MANAGER ?= "pcmciautils"

CVS_TARBALL_STASH += "http://www.o-hand.com/~richard/poky/sources/"

IMAGE_LINGUAS ?= "en-gb"
LIMIT_BUILT_LOCALES ?= "en_GB"
ENABLE_BINARY_LOCALE_GENERATION ?= "1"

DISTRO_FEATURES = "alsa bluetooth ext2 irda pcmcia usbgadget usbhost wifi nfs zeroconf"

POKY_EXTRA_RDEPENDS = ""
POKY_EXTRA_RDEPENDS_qemuarm = "qemu-config"
POKY_EXTRA_RDEPENDS_qemux86 = "qemu-config"

DISTRO_EXTRA_RDEPENDS += "${POKY_EXTRA_RDEPENDS}"
DISTRO_EXTRA_RRECOMMENDS += "kernel-module-af-packet"

IMAGE_FEATURES ?= ""

DISTRO_TASKS = "\
    task-poky-boot \
    task-base-extended \
    "

#
# Exclude known broken packages
#
# Needs scons/python-native
EXCLUDE_FROM_WORLD_pn-libsync = "1"
EXCLUDE_FROM_WORLD_pn-libopensync = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-syncml = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-evo2-sync = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-irmc-sync = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-file-sync = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-syncml-plugin = "1"
EXCLUDE_FROM_WORLD_pn-libopensync-plugin-syncml-client-plugin = "1"
EXCLUDE_FROM_WORLD_pn-msynctool = "1"
# Needs python
EXCLUDE_FROM_WORLD_pn-ipkg-utils = "1"
# Needs gcc 3.x
EXCLUDE_FROM_WORLD_pn-qemu = "1"
# compile failure
EXCLUDE_FROM_WORLD_pn-syncml-client = "1"
# temporary
EXCLUDE_FROM_WORLD_pn-lirc = "1"
EXCLUDE_FROM_WORLD_pn-lirc-modules = "1"
# clutter needs some kind of gl to build, not yet added
EXCLUDE_FROM_WORLD_pn-clutter = "1"
EXCLUDE_FROM_WORLD_pn-clutter-cairo = "1"
EXCLUDE_FROM_WORLD_pn-clutter-gst = "1"
EXCLUDE_FROM_WORLD_pn-aaina = "1"
EXCLUDE_FROM_WORLD_pn-table = "1"
EXCLUDE_FROM_WORLD_pn-task-poky-clutter = "1"
EXCLUDE_FROM_WORLD_pn-tidy = "1"
# Need bzr
EXCLUDE_FROM_WORLD_pn-eds-tools = "1"
# Need fixed Perl - OE bug #3403
EXCLUDE_FROM_WORLD_pn-libxml-parser-perl = "1"
# Needs gtk+ <= 2.10
EXCLUDE_FROM_WORLD_pn-gcalctool = "1"
