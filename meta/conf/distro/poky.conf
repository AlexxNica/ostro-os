#@TYPE: Distribution#@NAME: Poky
#@DESCRIPTION: Distribution configuration for OpenedHand (Poky)

DISTRO = "poky"
DISTRO_NAME = "OpenedHand Linux (Poky)"
DISTRO_VERSION = "0.0-snapshot-${DATE}"

MAINTAINER = "OpenedHand <poky@openedhand.com>"

PACKAGE_CLASSES ?= "package_ipk"
INHERIT += " ${PACKAGE_CLASSES} debian multimachine poky devshell "
#INHERIT += " package_deb debian multimachine poky devshell "
# For some reason, this doesn't work
# TARGET_OS ?= "linux"
TARGET_VENDOR = "-poky"
TARGET_OS = "linux"
TARGET_FPU_arm ?= "soft"
TARGET_FPU_armeb ?= "soft"
IMAGE_ROOTFS_SIZE_ext2 ?= "131072"

#FEED_URIS += " \
#           upgrades##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/upgrades/ \
#upgrades-${MACHINE}##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/upgrades/${MACHINE} \
#            machine##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/machine/${MACHINE} \
#               base##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/base/ \
#               libs##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/libs/ \
#            console##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/console \
#              devel##http://openzaurus.org/official/unstable/${DISTRO_VERSION}/feed/devel"

ASSUME_PROVIDED += "virtual/arm-linux-gcc-2.95"
OEINCLUDELOGS = "yes"
KERNEL_CONSOLE = "ttyS0"
#DEBUG_OPTIMIZATION = "-O -g3"
#DEBUG_BUILD = "1"
#INHIBIT_PACKAGE_STRIP = "1"

POKYMODE ?= "eabi"

require conf/distro/include/poky-${POKYMODE}.inc

#
# Preferred providers:
#
# Toolchain:
PREFERRED_PROVIDERS += " virtual/${TARGET_PREFIX}gcc-initial:gcc-cross-initial"
PREFERRED_PROVIDERS += " virtual/${TARGET_PREFIX}gcc:gcc-cross"
PREFERRED_PROVIDERS += " virtual/${TARGET_PREFIX}g++:gcc-cross"

# Libc/uclibc:
#fix some iconv issues, needs to be adjusted when doing uclibc builds
PREFERRED_PROVIDER_virtual/libiconv ?= "glibc"
PREFERRED_PROVIDER_virtual/libintl ?= "glibc"

# Virtuals:
PREFERRED_PROVIDER_virtual/db ?= "db"
PREFERRED_PROVIDER_virtual/db-native ?= "db-native"
PREFERRED_PROVIDER_virtual/xserver ?= xserver-kdrive
PREFERRED_PROVIDER_virtual/update-alternatives ?= update-alternatives-cworth
PREFERRED_PROVIDER_virtual/update-alternatives-native ?= update-alternatives-cworth-native
PREFERRED_PROVIDER_virtual/libx11 ?= "diet-x11"

# Others:
PREFERRED_PROVIDER_dbus-glib ?= "dbus-glib"
PREFERRED_PROVIDER_dbus-glib-native ?= "dbus-glib-native"
PREFERRED_PROVIDER_gconf ?= "gconf-dbus"
PREFERRED_PROVIDER_gnome-vfs ?= "gnome-vfs"
PREFERRED_PROVIDER_tslib ?= "tslib"
PREFERRED_PROVIDER_matchbox-desktop ?= "matchbox-desktop-2"
PREFERRED_PROVIDER_matchbox-panel ?= "matchbox-panel-2"


#
# CVS Dates to use:
#
SRCDATE_gconf-dbus ?= "20061219"
SRCDATE_contacts ?= "20060707"
SRCDATE_dates ?= "20070127"
SRCDATE_gtkhtml2 ?= "20060323"
SRCDATE_web ?= "20060613"
SRCDATE_eds-dbus ?= "20070330"
SRCDATE_minimo ?= "20050401"
SRCDATE_ipkg-utils-native ?= "20050930"
SRCDATE_ipkg-link-1 ?= "20050930"
SRCDATE_ipkg-utils ?= "20050930"
SRCDATE_ipkg-link ?= "20050930"
SRCDATE_matchbox-common ?= "20060612"
SRCDATE_matchbox-config-gtk ?= "20060612"
SRCDATE_matchbox-desktop ?= "20060612"
SRCDATE_matchbox-desktop-2 ?= "20070407"
SRCDATE_matchbox-keyboard ?= "20060612"
SRCDATE_matchbox-panel ?= "20060727"
SRCDATE_matchbox-panel-manager ?= "20060612"
SRCDATE_matchbox-panel-2 ?= "20070410"
SRCDATE_matchbox-stroke ?= "20060612"
SRCDATE_matchbox-themes-extra ?= "20060612"
SRCDATE_matchbox-wm ?= "20061223"
SRCDATE_libmatchbox ?= "20060729"
SRCDATE_settings-daemon ?= "20070104"
SRCDATE_screenshot ?= "20070125"
SRCDATE_xcalibrateext ?= "20051101"
SRCDATE_libfakekey ?= "20051101"
SRCDATE_xcalibrate ?= "20060312"
SRCDATE_qemu ?= "20060723"
SRCDATE_qemu-native ?= "20060723"
SRCDATE_oprofile ?= "20070106"
SRCDATE_zaurusd ?= "20070201"
SRCDATE_owl-video-widget ?= "20070201"
SRCDATE_psplash ?= "20070329"
SRCDATE_maemo-mapper-nohildon ?= "20061114"
SRCDATE_exmap-console = "20061220"
SRCDATE_gtk-sato-engine = "20070403"
SRCDATE_matchbox-theme-sato = "20070403"
SRCDATE_tasks = "20070317"
SRCDATE_sato-icon-theme = "20070403"

#
# Preferred Versions:
#
PREFERRED_VERSION_matchbox ?= "0.9.1"
PREFERRED_VERSION_matchbox-applet-inputmanager ?= "0.6"
PREFERRED_VERSION_matchbox-applet-startup-monitor ?= "0.1"
PREFERRED_VERSION_matchbox-common ?= "0.9.1+svn${SRCDATE}"
PREFERRED_VERSION_matchbox-config-gtk ?= "0.0+svn${SRCDATE}"
PREFERRED_VERSION_matchbox-desktop ?= "0.9.1+svn${SRCDATE}"
PREFERRED_VERSION_matchbox-keyboard ?= "0.0+svn${SRCDATE}"
PREFERRED_VERSION_matchbox-panel ?= "0.9.2+svn${SRCDATE}"
PREFERRED_VERSION_matchbox-stroke ?= "0.0+svn${SRCDATE}"
PREFERRED_VERSION_matchbox-themes-extra ?= "0.3+svn${SRCDATE}"
PREFERRED_VERSION_matchbox-wm ?= "1.1+svn${SRCDATE}"
PREFERRED_VERSION_libmatchbox ?= "1.9"

PREFERRED_VERSION_glib-2.0 ?= "2.10.3"
PREFERRED_VERSION_glib-2.0-native ?= "2.10.3"
PREFERRED_VERSION_atk ?= "1.10.3"
PREFERRED_VERSION_cairo ?= "1.0.4"
PREFERRED_VERSION_pango ?= "1.10.2"
PREFERRED_VERSION_gtk+ ?= "2.6.8"
#PREFERRED_VERSION_gtk+ ?= "2.8.16"

PREFERRED_VERSION_dbus ?= "1.0.1"
PREFERRED_VERSION_dbus-native ?= "1.0.1"
PREFERRED_VERSION_dbus-glib ?= "0.72"
PREFERRED_VERSION_dbus-glib-native ?= "0.72"
PREFERRED_VERSION_gnome-vfs ?= "2.16.3"

PREFERRED_VERSION_dillo2 ?= "0.6.6"
PREFERRED_VERSION_evince ?= "0.3.2"
PREFERRED_VERSION_firefox ?= "1.0"
PREFERRED_VERSION_gaim ?= "2.0.0-cvs-mco1-20050904"
PREFERRED_VERSION_gtk2-theme-angelistic ?= "0.3"
PREFERRED_VERSION_keylaunch ?= "2.0.7"
PREFERRED_VERSION_librsvg ?= "2.6.5"
PREFERRED_VERSION_libgsm ?= "1.0.10"
PREFERRED_VERSION_libschedule ?= "0.15"
PREFERRED_VERSION_linphone-hh ?= "0.12.2.hh1"
PREFERRED_VERSION_linphone ?= "0.12.2"
PREFERRED_VERSION_minilite ?= "0.49"
PREFERRED_VERSION_minimo ?= "0.0+cvs${SRCDATE_minimo}"
PREFERRED_VERSION_poppler ?= "0.3.3"
PREFERRED_VERSION_rosetta ?= "0.0+cvs${SRCDATE}"
PREFERRED_VERSION_rxvt-unicode ?= "5.6"
PREFERRED_VERSION_xcursor-transparent-theme ?= "0.1.1"
PREFERRED_VERSION_xdemineur ?= "2.1.1"
PREFERRED_VERSION_xextensions ?= "1.0.1"


PREFERRED_VERSION_xmonobut ?= "0.4"
PREFERRED_VERSION_xprop ?= "0.0+cvs${SRCDATE}" 
PREFERRED_VERSION_xst ?= "0.15"
PREFERRED_VERSION_oprofile ?= "0.9.2+cvs${SRCDATE}"
PREFERRED_VERSION_elfutils ?= "0.89"
PREFERRED_VERSION_hal ?= "0.5.9"

require conf/distro/include/preferred-xorg-versions.inc

PCMCIA_MANAGER ?= "pcmciautils"

CVS_TARBALL_STASH += "http://www.o-hand.com/~richard/poky/sources/"

IMAGE_LINGUAS = "en-gb"

ENABLE_BINARY_LOCALE_GENERATION ?= "1"

DISTRO_FEATURES = "alsa bluetooth ext2 irda pcmcia usbgadget usbhost wifi"
DISTRO_FEATURES_cmx270 = "alsa bluetooth ext2 irda pcmcia usbgadget usbhost"

POKY_EXTRA_RDEPENDS = ""
POKY_EXTRA_RDEPENDS_qemuarm = "qemu-config"
POKY_EXTRA_RDEPENDS_qemux86 = "qemu-config"
POKY_EXTRA_RDEPENDS_akita = "pointercal"

DISTRO_EXTRA_RDEPENDS += "${POKY_EXTRA_RDEPENDS}"

IMAGE_FEATURES ?= ""

DISTRO_TASKS = "\
    task-oh-boot \
    ${@base_contains("IMAGE_FEATURES", "dbg-pkgs", "task-oh-boot-dbg", "",d)} \
    ${@base_contains("IMAGE_FEATURES", "dev-pkgs", "task-oh-boot-dev", "",d)} \
    task-oh-boot-extras \
    ${@base_contains("IMAGE_FEATURES", "dbg-pkgs", "task-oh-boot-extras-dbg", "",d)} \
    ${@base_contains("IMAGE_FEATURES", "dev-pkgs", "task-oh-boot-extras-dev", "",d)} \
    ${@base_contains("IMAGE_FEATURES", "apps-core", "task-oh-base", "",d)} \
    ${@base_contains("IMAGE_FEATURES", ["apps-core", "dbg-pkgs"], "task-oh-base-dbg", "",d)} \
    ${@base_contains("IMAGE_FEATURES", ["apps-core", "dev-pkgs"], "task-oh-base-dev", "",d)} \
    ${@base_contains("IMAGE_FEATURES", "apps-pda", "task-oh-standard", "",d)} \
    ${@base_contains("IMAGE_FEATURES", ["apps-pda", "dbg-pkgs"], "task-oh-standard-dbg", "",d)} \
    ${@base_contains("IMAGE_FEATURES", ["apps-pda", "dev-pkgs"], "task-oh-standard-dev", "",d)} \
    ${@base_contains("IMAGE_FEATURES", "dev-tools", "task-oh-sdk", "",d)} \    
    ${@base_contains("IMAGE_FEATURES", ["dev-tools", "dbg-pkgs"], "task-oh-sdk-dbg", "",d)} \
    ${@base_contains("IMAGE_FEATURES", ["dev-tools", "dev-pkgs"], "task-oh-sdk-dev", "",d)} \
    ${@base_contains("IMAGE_FEATURES", "dbg-tools", "task-oh-devtools", "",d)} \
    ${@base_contains("IMAGE_FEATURES", ["dbg-tools", "dbg-pkgs"], "task-oh-devtools-dbg", "",d)} \
    ${@base_contains("IMAGE_FEATURES", ["dbg-tools", "dev-pkgs"], "task-oh-devtools-dev", "",d)} \
    ${@base_contains("IMAGE_FEATURES", "test-tools", "task-oh-testapps", "",d)} \
    ${@base_contains("IMAGE_FEATURES", ["test-tools", "dbg-pkgs"], "task-oh-testapps-dbg", "",d)} \
    ${@base_contains("IMAGE_FEATURES", ["test-tools", "dev-pkgs"], "task-oh-testapps-dev", "",d)} \
    ${@base_contains("IMAGE_FEATURES", "nfs-server", "task-oh-nfs-server", "",d)} \
    "
